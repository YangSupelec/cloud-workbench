# The following variables are available
# benchmark_name: Name of the benchmark definition from the web interface
# benchmark_name_sanitized: benchmark_name where all non-word-characters are replaced with an underscore '_'
# benchmark_id: The unique benchmark definition identifier
# execution_id: The unique benchmark execution identifier
# chef_node_name: The default node name used for Chef client provisioning
# tag_name: The default tag name set as aws name tag

# VAGRANTFILE_API_VERSION = "2"  # Already initialized before
Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
  # AWS EC2 provider
  config.vm.provider :aws do |aws, override|
    # AWS instance configuration
    aws.region = "eu-west-1"
    # Official Ubuntu 14.04 LTS image for eu-west-1 from Canonical:
    #  https://cloud-images.ubuntu.com/locator/ec2/
    aws.ami = "ami-896c96fe"
    override.ssh.username = "ubuntu"
    aws.instance_type = "t1.micro"
    # Add other security groups separated by spaces.
    # Example: %w(default my_own_group)
    # aws.security_groups = %w(default)
    # A default tag name is set that you may override.
    # aws.tags = {
    #   'Name' => tag_name
    # }
  end

  # Chef client provisioning
  config.vm.provision "chef_client", id: "chef_client" do |chef|
    # NOTE: Make sure to include the 'recipe[benchmark]'
    #       if you use chef.run_list = [...] which is NOT RECOMMENDED
    # Optional version number: 'sysbench@0.2.0'
    chef.add_recipe "sysbench"
    # NOTE: Do NOT use the ["benchmark"] attribute namespace for your own attributes
    #       It is highly recommended to use the name of the cookbook as the attribute namespace.
    chef.json =
    {
# Uncomment the following lines to change the default username 'ubuntu'
#     "benchmark" =>  {
#       "owner" => "root",
#       "group" => "root"
#     },
      "sysbench" => {
        "repetitions" => "2",
        "cli_options" => {
          "test" => "cpu",
          "cpu-max-prime" => "8000",
        }
      }
    } # END json
  end
end

# Google Compute Engine provider
# config.vm.provider :google do |google, override|
#   google.image = "debian-7-wheezy-v20140619"
#   override.ssh.username = "root"
#   google.machine_type = "n1-standard-1"
#   google.zone = "europe-west1-a"
# end
